<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶∑</text></svg>">
    <link rel="stylesheet" href="/static/css/common.css">
</head>
<body>
    <div class="container">
        <h1 id="pageTitle">ü¶∑ CRM –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è</h1>
        <div class="welcome">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫–ª–∏–Ω–∏–∫–æ–π
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="todayAppointments">-</div>
                <div class="stat-label">–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="todayIncome">-</div>
                <div class="stat-label">–î–æ—Ö–æ–¥ —Å–µ–≥–æ–¥–Ω—è (‚Ç∏)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalPatients">-</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</div>
            </div>
        </div>

        <div class="quick-actions">
            <a href="/patients-appointments.html" class="quick-action-card">
                <span class="quick-action-icon">üë•üìÖ</span>
                <div class="quick-action-title">–ü–∞—Ü–∏–µ–Ω—Ç—ã –∏ –ó–∞–ø–∏—Å–∏</div>
                <div class="quick-action-desc">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∏–µ–º–æ–≤</div>
            </a>
            <a href="/services.html" class="quick-action-card">
                <span class="quick-action-icon">‚öôÔ∏è</span>
                <div class="quick-action-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="quick-action-desc">–£—Å–ª—É–≥–∏, –≤—Ä–∞—á–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</div>
            </a>
            <a href="/reports.html" class="quick-action-card">
                <span class="quick-action-icon">üìä</span>
                <div class="quick-action-title">–û—Ç—á—ë—Ç—ã</div>
                <div class="quick-action-desc">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            </a>
        </div>

        <div class="nav">
            <a href="/patients-appointments.html">üë•üìÖ –ü–∞—Ü–∏–µ–Ω—Ç—ã –∏ –ó–∞–ø–∏—Å–∏</a>
            <a href="/doctors.html">üë®‚Äç‚öïÔ∏è –í—Ä–∞—á–∏</a>
            <a href="/services.html">‚öôÔ∏è –£—Å–ª—É–≥–∏</a>
            <a href="/reports.html">üìä –û—Ç—á—ë—Ç—ã</a>
        </div>
    </div>

    <div id="toast"></div>

    <div style="position:fixed;bottom:10px;right:10px;background:#2d3748;color:#a0aec0;padding:6px 12px;border-radius:4px;font-size:12px;">
        v1.0.1 ‚Ä¢ Deploy: Jan 6, 2026
    </div>

    <script src="/static/js/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            if (!Auth.check()) return;

            // Update header with user info
            const user = Auth.getUser();
            const roleText = user.isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–í—Ä–∞—á';
            document.getElementById('pageTitle').innerHTML =
                `ü¶∑ CRM –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è <span style="font-size:14px;color:#666;">(${user.name} - ${roleText})</span>`;

            Auth.setupLogoutButton();

            // Load dashboard stats
            try {
                const response = await API.get('/api/dashboard');
                const stats = response.data;

                document.getElementById('todayAppointments').textContent = stats.today_appointments || 0;
                document.getElementById('todayIncome').textContent = Currency.format(stats.today_revenue || 0);
                document.getElementById('totalPatients').textContent = stats.total_patients || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
                Toast.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
            }
        });
    </script>
</body>
</html>
